<!DOCTYPE HTML>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>
  [Vaggland] CoffeeScript brush for SyntaxHighlighter
</title>
    <link rel="stylesheet" href="/style.css" type="text/css">
    <script type="text/javascript" src="http://use.typekit.com/swo4snt.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>  
    <script type="text/javascript">
    /*
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-139519-10']);
              _gaq.push(['_trackPageview']);
      (function () {
          var ga = document.createElement('script');
          ga.type = 'text/javascript';
          ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
      }())
    */
    </script>
  </head>
  <body>

    <section class="content">
      <h1>
        <a href="/">Vaggland</a>
      </h1>

      <section class="nav">
        <section class="me">
          <span>Find me</span>
          <ul>
            <li>on <a href="https://twitter.com/rvagg">Twitter / @rvagg</a></li>
            <li>on <a href="https://twitter.com/github">GitHub / @rvagg</a></li>
          </ul>
        </section>
        <section class="recent">
          <span>Recent posts</span>
          <ul>
            
 
                <li><a href="/2012/08/bean-v1.html">Announcing Bean v1.0.0</a></li>
              
 
 
                <li><a href="/2012/07/ender-bundling.html">How Ender bundles libraries for the browser</a></li>
              
 
 
                <li><a href="/2012/07/bean_v1.html">Towards Bean v1.0 (or: How event managers do their thing)</a></li>
              
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
          </ul>
        </section>
      </section>
      <div style="clear: both;"></div>

      

  <section class="post-content">

    <h2><a href="/2011/01/coffeescript-brush-for-syntaxhighlighter.html">CoffeeScript brush for SyntaxHighlighter</a></h2>

    <p class="byline">by Rod Vagg on February 16, 2011</p>

    <section class="post-body">
      <p>I have finally got around to setting up my blog, I&#39;ve been meaning to do so for a long time as a place to store interesting bits of code and techniques that I haven&#39;t found elsewhere on the web. One of the things I want to share from time to time is the beautiful way that <a href="http://coffeescript.org/">CoffeeScript</a>, <a href="http://prototypejs.org/">Prototype</a> and <a href="http://scripty2.com/">Scripty2</a> work together. Unfortunately I couldn&#39;t find a syntax highlighter option for CoffeeScript beyond embedding <a href="https://gist.github.com/">Gists</a> or similar.</p>
<p>So, I picked up the <a href="http://www.viper007bond.com/wordpress-plugins/syntaxhighlighter/">SyntaxHighlighter Evolved</a> plugin for WordPress and started hacking. Language <i>brushes</i> as they are called are really just JavaScript objects that bundle a bunch of regular expressions and match them to CSS attributes. SyntaxHighlighter does the rest. Most of the brushes included are pretty basic and mainly do keywords, strings and comments and a few other minor things. The aim is basically to show something that&#39;s easier on the eye than plain code. Highlighting just keywords, string and comments is surprisingly effective in doing this.</p>
<p>But we can do a bit better than that. Since it&#39;s JavaScript regular expressions we are a little limited and can&#39;t parse the whole language easily so I&#39;ve stopped quite a bit short and some of it is hit-and-miss, especially variable matching since CoffeeScript is pretty lose.</p>
<p>Firstly here&#39;s some examples, these are taken straight from the <a href="http://coffeescript.org/">CoffeeScript</a> site:</p>
<p><strong>Functions</strong></p>
<p>[code lang=&quot;coffeescript&quot;]
square = (x) -&gt; x <em> x
cube   = (x) -&gt; square(x) </em> x
[/code]</p>
<p>[coffee]
fill = (container, liquid = &quot;coffee&quot;) -&gt;
  &quot;Filling the #{container} with #{liquid}...&quot;
[/coffee]</p>
<p><strong>Objects and Arrays</strong></p>
<p>[coffee]
song = [&quot;do&quot;, &quot;re&quot;, &quot;mi&quot;, &quot;fa&quot;, &quot;so&quot;]</p>
<p>singers = {Jagger: &quot;Rock&quot;, Elvis: &quot;Roll&quot;}</p>
<p>bitlist = [
  1, 0, 1
  0, 0, 1
  1, 1, 0
]</p>
<p>kids =
  brother:
    name: &quot;Max&quot;
    age:  11
  sister:
    name: &quot;Ida&quot;
    age:  9
[/coffee]</p>
<p>[coffee]
$(&#39;.account&#39;).attr class: &#39;active&#39;</p>
<p>log object.class
[/coffee]</p>
<p><strong>Lexical Scoping and Variable Safety</strong></p>
<p>[coffee]
outer = 1
changeNumbers = -&gt;
  inner = -1
  outer = 10
inner = changeNumbers()
[/coffee]</p>
<p><strong>If, Else, Unless, and Conditional Assignment</strong></p>
<p>[coffee]
mood = greatlyImproved if singing</p>
<p>if happy and knowsIt
  clapsHands()
  chaChaCha()
else
  showIt()</p>
<p>date = if friday then sue else jill</p>
<p>options or= defaults
[/coffee]</p>
<p><strong>Splats...</strong></p>
<p>[coffee]
gold = silver = rest = &quot;unknown&quot;</p>
<p>awardMedals = (first, second, others...) -&gt;
  gold   = first
  silver = second
  rest   = others</p>
<p>contenders = [
  &quot;Michael Phelps&quot;
  &quot;Liu Xiang&quot;
  &quot;Yao Ming&quot;
  &quot;Allyson Felix&quot;
  &quot;Shawn Johnson&quot;
  &quot;Roman Sebrle&quot;
  &quot;Guo Jingjing&quot;
  &quot;Tyson Gay&quot;
  &quot;Asafa Powell&quot;
  &quot;Usain Bolt&quot;
]</p>
<p>awardMedals contenders...</p>
<p>alert &quot;Gold: &quot; + gold
alert &quot;Silver: &quot; + silver
alert &quot;The Field: &quot; + rest
[/coffee]</p>
<p><strong>Loops and Comprehensions</strong></p>
<p>[coffee]</p>
<h1>Eat lunch.</h1>
<p>eat food for food in [&#39;toast&#39;, &#39;cheese&#39;, &#39;wine&#39;]
[/coffee]</p>
<p>[coffee]
countdown = (num for num in [10..1])
[/coffee]</p>
<p>[coffee]
yearsOld = max: 10, ida: 9, tim: 11</p>
<p>ages = for child, age of yearsOld
  child + &quot; is &quot; + age
[/coffee]</p>
<p>[coffee]</p>
<h1>Econ 101</h1>
<p>if this.studyingEconomics
  buy()  while supply &gt; demand
  sell() until supply &gt; demand</p>
<h1>Nursery Rhyme</h1>
<p>num = 6
lyrics = while num -= 1
  num + &quot; little monkeys, jumping on the bed.
    One fell out and bumped his head.&quot;
[/coffee]</p>
<p>[coffee]
for filename in list
  do (filename) -&gt;
    fs.readFile filename, (err, contents) -&gt;
      compile filename, contents.toString()
[/coffee]</p>
<p><strong>Array Slicing and Splicing with Ranges</strong></p>
<p>[coffee]
numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</p>
<p>copy    = numbers[0...numbers.length]</p>
<p>middle  = copy[3..6]
[/coffee]</p>
<p>[coffee]
numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</p>
<p>numbers[3..6] = [-3, -4, -5, -6]
[/coffee]</p>
<p><strong>Everything is an Expression (at least, as much as possible)</strong></p>
<p>[coffee]
grade = (student) -&gt;
  if student.excellentWork
    &quot;A+&quot;
  else if student.okayStuff
    if student.triedHard then &quot;B&quot; else &quot;B-&quot;
  else
    &quot;C&quot;</p>
<p>eldest = if 24 &gt; 21 then &quot;Liz&quot; else &quot;Ike&quot;
[/coffee]</p>
<p>[coffee]
six = (one = 1) + (two = 2) + (three = 3)
[/coffee]</p>
<p>[coffee]</p>
<h1>The first ten global properties.</h1>
<p>globals = (name for name of window)[0...10]
[/coffee]</p>
<p>[coffee]
alert(
  try
    nonexistent / undefined
  catch error
    &quot;And the error is ... &quot; + error
)
[/coffee]</p>
<p><strong>Operators and Aliases</strong></p>
<p>[coffee]
launch() if ignition is on</p>
<p>volume = 10 if band isnt SpinalTap</p>
<p>letTheWildRumpusBegin() unless answer is no</p>
<p>if car.speed &lt; limit then accelerate()</p>
<p>winner = yes if pick in [47, 92, 13]</p>
<p>print inspect &quot;My name is &quot; + @name
[/coffee]</p>
<p><strong>The Existential Operator</strong></p>
<p>[coffee]
solipsism = true if mind? and not world?</p>
<p>speed ?= 75</p>
<p>footprints = yeti ? &quot;bear&quot;
[/coffee]</p>
<p>[coffee]
zip = lottery.drawWinner?().address?.zipcode
[/coffee]</p>
<p><strong>Classes, Inheritance, and Super</strong></p>
<p>[coffee]
class Animal
  constructor: (@name) -&gt;</p>
<p>  move: (meters) -&gt;
    alert @name + &quot; moved &quot; + meters + &quot;m.&quot;</p>
<p>class Snake extends Animal
  move: -&gt;
    alert &quot;Slithering...&quot;
    super 5</p>
<p>class Horse extends Animal
  move: -&gt;
    alert &quot;Galloping...&quot;
    super 45</p>
<p>sam = new Snake &quot;Sammy the Python&quot;
tom = new Horse &quot;Tommy the Palomino&quot;</p>
<p>sam.move()
tom.move()
[/coffee]</p>
<p>[coffee]
String::dasherize = -&gt;
  this.replace /_/g, &quot;-&quot;
[/coffee]</p>
<p><strong>Destructuring Assignment</strong></p>
<p>[coffee]
theBait   = 1000
theSwitch = 0</p>
<p>[theBait, theSwitch] = [theSwitch, theBait]
[/coffee]</p>
<p>[coffee]
weatherReport = (location) -&gt;</p>
<h1>Make an Ajax request to fetch the weather...</h1>
<p>  [location, 72, &quot;Mostly Sunny&quot;]</p>
<p>[city, temp, forecast] = weatherReport &quot;Berkeley, CA&quot;
[coffee]</p>
<p>[coffee]
futurists =
  sculptor: &quot;Umberto Boccioni&quot;
  painter:  &quot;Vladimir Burliuk&quot;
  poet:
    name:   &quot;F.T. Marinetti&quot;
    address: [
      &quot;Via Roma 42R&quot;
      &quot;Bellagio, Italy 22021&quot;
    ]</p>
<p>{poet: {name, address: [street, city]}} = futurists
[/coffee]</p>
<p>[coffee]
tag = &quot;&lt;impossible&gt;&quot;</p>
<p>[open, contents..., close] = tag.split(&quot;&quot;)
[/coffee]</p>
<p><strong>Function binding</strong></p>
<p>[coffee]
Account = (customer, cart) -&gt;
  @customer = customer
  @cart = cart</p>
<p>  $(&#39;.shopping_cart&#39;).bind &#39;click&#39;, (event) =&gt;
    @customer.purchase @cart
[/coffee]</p>
<p><strong>Embedded JavaScript</strong></p>
<p>[coffee]
hi = <code>function() {
  return [document.title, &amp;quot;Hello JavaScript&amp;quot;].join(&amp;quot;: &amp;quot;);
}</code>
[/coffee]</p>
<p><strong>Switch/When/Else</strong></p>
<p>[coffee]
switch day
  when &quot;Mon&quot; then go work
  when &quot;Tue&quot; then go relax
  when &quot;Thu&quot; then go iceFishing
  when &quot;Fri&quot;, &quot;Sat&quot;
    if day is bingoDay
      go bingo
      go dancing
  when &quot;Sun&quot; then go church
  else go work
[/coffee]</p>
<p><strong>Try/Catch/Finally</strong></p>
<p>[coffee]
try
  allHellBreaksLoose()
  catsAndDogsLivingTogether()
catch error
  print error
finally
  cleanUp()
[/coffee]</p>
<p><strong>Chained Comparisons</strong></p>
<p>[coffee]
cholesterol = 127</p>
<p>healthy = 200 &gt; cholesterol &gt; 60
[/coffee]</p>
<p><strong>String Interpolation, Heredocs, and Block Comments</strong></p>
<p>[coffee]
author = &quot;Wittgenstein&quot;
quote  = &quot;A picture is a fact. -- #{ author }&quot;</p>
<p>sentence = &quot;#{ 22 / 7 } is a decent approximation of Ï€&quot;
[/coffee]</p>
<p>[coffee]
mobyDick = &quot;Call me Ishmael. Some years ago --
 never mind how long precisely -- having little
 or no money in my purse, and nothing particular
 to interest me on shore, I thought I would sail
 about a little and see the watery part of the
 world...&quot;
[/coffee]</p>
<p>[coffee]
html = &#39;&#39;&#39;
       &lt;strong&gt;
         cup of coffeescript
       &lt;/strong&gt;
       &#39;&#39;&#39;
[/coffee]</p>
<p>[coffee]</p>
<h2>#</h2>
<p>CoffeeScript Compiler v1.0.1
Released under the MIT License</p>
<h2>#</h2>
<p>[/coffee]</p>
<p><strong>Extended Regular Expressions</strong></p>
<p>[coffee]
OPERATOR = /// ^ (
  ?: [-=]&gt;             # function
   | [-+*/%&lt;&gt;&amp;|^!?=]=  # compound assign / compare
   | &gt;&gt;&gt;=?             # zero-fill right shift
   | ([-+:])\1         # doubles
   | ([&amp;|&lt;&gt;])\2=?      # logic / shift
   | \?.              # soak access
   | .{2,3}           # range or splat
) ///
[/coffee]</p>
<p><strong>Cake, and Cakefiles</strong></p>
<p>[coffee]
fs = require &#39;fs&#39;</p>
<p>option &#39;-o&#39;, &#39;--output [DIR]&#39;, &#39;directory for compiled code&#39;</p>
<p>task &#39;build:parser&#39;, &#39;rebuild the Jison parser&#39;, (options) -&gt;
  require &#39;jison&#39;
  code = require(&#39;./lib/grammar&#39;).parser.generate()
  dir  = options.output or &#39;lib&#39;
  fs.writeFile &quot;#{dir}/parser.js&quot;, code
[/coffee]</p>
<p>And lastly, there&#39;s the brush code itself, which is written in CoffeeScript of course! Variables, this/@ and prototype access isn&#39;t quite to my liking, plus it&#39;s not comprehensive enough. For example, I would have liked variables within function calls to be highlighted but they aren&#39;t, they are only highlighted when they are assigned.</p>
<p>If you have any additions or modifications that improve on this then I&#39;d love to see them!</p>
<p>[coffee]</p>
<h2>#</h2>
<p>By Rod Vagg &lt;rod@vagg.org&gt; / @rvagg / <a href="http://rod.vagg.org">http://rod.vagg.org</a>
Released under the do-what-you-like-,-attribution-would-be-nice-,-but-please-don&#39;t-pass-off-as-your-own-work licence.</p>
<h2>#</h2>
<h1>Compile with: coffee -cb shBrushCoffeeScript.coffee</h1>
<p>SyntaxHighlighter.brushes.CoffeeScript = -&gt;
    jsKeywords = &#39;if else new return try catch finally throw break continue for in while delete instanceof typeof switch super extends class case default do function var void with const let debugger enum export import native <strong>extends </strong>hasProp&#39;
    csKeywords = &#39;then unless and or is isnt not of by where when until&#39;
    keywords = jsKeywords + &#39; &#39; + csKeywords</p>
<pre><code>@regexList = [
    { regex: SyntaxHighlighter.regexLib.singleLinePerlComments, css: &#39;comments&#39; },
    # pass-through comment block
    { regex: /\#\#\#[\s\S]*?\#\#\#/gm, css: &#39;comments&#39; },

    { regex: SyntaxHighlighter.regexLib.multiLineDoubleQuotedString, css: &#39;string&#39; },
    { regex: SyntaxHighlighter.regexLib.doubleQuotedString, css: &#39;string&#39; },
    { regex: SyntaxHighlighter.regexLib.singleQuotedString, css: &#39;string&#39; },
    # heredocs
    { regex: /\&#39;\&#39;\&#39;[\s\S]*?\&#39;\&#39;\&#39;/gm, css: &#39;string&#39; },
    # extended regular expressions
    { regex: /\/\/\/[\s\S]*?\/\/\//gm, css: &#39;string&#39; },

    { regex: /\b([\d]+(\.[\d]+)?|0x[a-f0-9]+)\b/gmi, css: &#39;value&#39; },

    # I&#39;m not sure whether these next two should be variables or &#39;color1&#39; or something else
    # @ &amp;amp; this variables
    { regex: /(@[\w._]*|this[\w._]*)/g, css: &#39;variable bold&#39; },
    # prototype references
    { regex: /(([\w._]+)::([\w._]*))/g, css: &#39;variable bold&#39; },

    # variables when used in assignment
    { regex: /([\w._]+)\s*(?=\=)/g, css: &#39;variable bold&#39; },

    # operators and other punctuational syntax
            { regex: /(-&amp;amp;gt;|-&amp;gt;|=&amp;amp;gt;|=&amp;gt;|===|==|=|&amp;gt;|&amp;amp;gt;|&amp;lt;|&amp;amp;lt;|\.\.\.|&amp;amp;&amp;amp;|&amp;amp;amp;&amp;amp;amp;|\|\||\!\!|\!|\+\+|\+|--|-|\[|\]|\(|\)|\{|\})|\?|\/|\*|\%/g, css: &#39;keyword&#39; },
    { regex: new RegExp(@getKeywords(keywords), &#39;gm&#39;), css: &#39;keyword&#39; },
]
undefined</code></pre>
<p>SyntaxHighlighter.brushes.CoffeeScript:: = new SyntaxHighlighter.Highlighter()
SyntaxHighlighter.brushes.CoffeeScript.aliases = [ &#39;coffeescript&#39;, &#39;CoffeeScript&#39;, &#39;coffee&#39; ]
[/coffee]</p>
<p>Alternatively, the raw code is <a href="http://js.vagg.org/coffee/shBrushCoffeeScript.coffee">here</a> and the compiled JavaScript version is <a href="http://js.vagg.org/coffee/shBrushCoffeeScript.js">here</a>.</p>
<p>If you want to install it directly into the SyntaxHighlighter Evolved plugin then put the JavaScript file into the <code>syntaxhighlighter/third-party-brushes</code> directory. Edit <code>syntaxhighlighter.php</code> and add this line to the section marked <em>&quot;Register some popular third-party brushes&quot;</em>:
[php]
wp_register_script( &#39;syntaxhighlighter-brush-coffeescript&#39;, plugins_url(&#39;syntaxhighlighter/third-party-brushes/shBrushCoffeeScript.js&#39;), array(&#39;syntaxhighlighter-core&#39;), &#39;20110214&#39;);
[/php]
And this line somewhere in the list of languages in the section not far below that which sets up <code>$this-&gt;brushes</code> (it should be obvious):
[php]
&#39;coffeescript&#39;  =&gt; &#39;coffeescript&#39;,
[/php]</p>
<p>Unfortunately you&#39;ll have to do this each time the plugin is updated.</p>
<p>Would love to hear from you if you find this useful!</p>
<p><strong>Update 11-Jul-2011:</strong> I neglected to add that I also have the following line in the brushes list section:
[php]
&#39;coffee&#39;  =&gt; &#39;coffeescript&#39;,
[/php]
I do this so I can simply use [ coffee ][ /coffee ] blocks.</p>

    </section>

  </section>



      <section class="footer">
        &copy; Rod Vagg 2013, powered by <a href="https://github.com/rvagg/blorg">Blorg</a>
      </section>

    </section>

  </body>
</html>